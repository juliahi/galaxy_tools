<tool id="gene_ontology" name="Gene ontology enrichment">
<requirements>
</requirements>

  <description>TODO</description>
  <command interpreter="python"> 
        # if $params.method == "gsea"
            run_ranked_enrichment.py    GSEA            -p $params.perms -n $params.minset -c $params.corrpower
	#elif $params.method == "rpc"
            run_ranked_enrichment.py    parent-child    -s $params.side -c $params.corrections -m $params.method
        #elif $params.method == "pc"
            run_enrichment.py           parent-child    -c $params.corrections  -m $params.method
        #elif $params.method == "tt"
            run_enrichment.py           term-for-term   -c $params.corrections 
	#end if
            -i ${input.file_name} -a ${assoc.file_name} -g ${go_graph.file_name}
            -f html -o ${output.file_name} -x $params.field 
</command>
  <inputs>
      <param name="input" label="DESeq results" format="txt" type="data" />
      <param name="assoc" label="Association" format="gaf" type="data" />
      <param name="go_graph" label="GO annotation" format="obo" type="data" />

      <conditional name="params">
	<param name="method" type="select" label="Enrichment analysis method">
	  <option value="tt">Term for term</option>
	  <option value="pc">Parent-child</option>
	  <option value="gsea">GSEA (use ranking)</option>
	  <option value="rpc">Ranked Parent-child</option>
	</param>

        <param name="field" type="select" label="Which column to use">
            <!--id      baseMean    baseMeanA       baseMeanB       foldChange      log2FoldChange  pval    padj-->
          <option value="5">foldChange</option>
          <option value="6">log2FoldChange</option>
          <option value="7">p-value</option>
          <option value="8">p-value (adjusted)</option>
        </param>


	
	<when value="gsea">
	  <!-- <param name="perms" label="Number of permitations (for computing p-value)" type="integer" value="1000" min="10" max="10000" />-->
	  <param name="perms" label="Number of permitations (for computing p-value)" type="select" multiple="false" >
		<option value="10">10</option>
		<option value="100"  selected="True">100</option>
		<option value="1000">1000</option>
		<option value="10000">10000</option>
	  </param>
	  <param name="minset" label="Minimal intersection between set of genes in rank and in studied set" type="integer" value="1" min="1" max="100" />
	  <param name="corrpower" label="How strong correlation will affect enrichment" type="float" value="1" min="0" max="1" />
	</when>

	<when value="rpc">
	  <!-- <param name="perms" label="Number of permitations (for computing p-value)" type="integer" value="1000" min="10" max="10000" />-->
	  <param name="side" label="from which side (highest or lowest) to start computation" type="select" multiple="false" >
		<option value="+" selected="True" >highest</option>
		<option value="-">lowest</option>
		<option value="+/-">both</option>
	  </param>
	  <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true" >
		<option value="bonferroni">Bonferroni</option>
		<option value="bh_fdr">Benjamini-Hochberg FDR</option>
	  </param>
	  <param name="rank-as-population" label="only the rank should be used as population" type="boolean" value="false" />
	  <param name="method" label="method used to compute probabilities" type="select" multiple="false" required="true" >
		<option value="union" selected="True">parent_child_union (default)</option>
		<option value="intersection">parent_child_intersection</option>
		<option value="term">Term for term</option>
	  </param>
	</when>

        <when value="pc">          
          <param name="cutoff" label="Cut genes at this value in selected field (less or equal for p-values, more for FoldChange)" 
                 type="float" value="0.05"/>
          <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true" >
                <option value="bonferroni">Bonferroni</option>
                <option value="bh_fdr">Benjamini-Hochberg FDR</option>
          </param>
          <param name="method" label="method used to compute probabilities" type="select" multiple="false" required="true" >
                <option value="union" selected="True">parent_child_union (default)</option>
                <option value="intersection">parent_child_intersection</option>
                <option value="term">Term for term</option>
          </param>
          
          
          
        </when>
        <when value="tt">
          <param name="cutoff" label="Cut genes at this value in selected field (less or equal for p-values, more for FoldChange)" 
                 type="float" value="0.05"/>
          
          <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true" >
                <option value="bonferroni">Bonferroni</option>
                <option value="bh_fdr">Benjamini-Hochberg FDR</option>
          </param>
          
        </when>

      </conditional>

  </inputs>
  <outputs>
        <data format="html" name="output" label="${tool.name} on ${on_string}"/>
  </outputs>

  <tests>
  </tests>

  <help>

Method and implementation: Kamil Koziara

Wrapper: Julia
  </help>

</tool>


