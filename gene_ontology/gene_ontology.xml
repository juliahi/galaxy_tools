<tool id="gene_ontology" name="Gene ontology enrichment">
<requirements>
</requirements>

  <description>Find enriched GO terms from DESeq results</description>
  <command interpreter="python"> 
        #if $params.method == "gsea"
            run_ranked_enrichment.py    GSEA            -p $params.perms -n $params.minset -c $params.corrpower -x 6  
	#elif $params.method == "rpc"
            run_ranked_enrichment.py    parent-child    -s "$params.side" -m $params.method -x 6 
            #if $params.rank
                -r
            #end if
            #if $params.corrections
                -c $params.corrections  
            #end if
        #elif $params.method == "pc"
            run_enrichment.py           parent-child    -m "$params.method" -x $params.cutoff.field -l $params.cutoff.level
            #if $params.corrections
                -c $params.corrections  
            #end if
        #elif $params.method == "tt"
            run_enrichment.py           term-for-term   -x $params.cutoff.field -l $params.cutoff.level
            #if $params.corrections
                -c $params.corrections  
            #end if
	#end if
        

            -i ${input.file_name} -a ${assoc.file_name} 
            <!--#if $go_graph.source == "user"
                -g ${go_graph.go_file.file_name}
            #else
                -g $go_graph.go_cashed
            #end if-->
            -g ${go_graph.file_name}
            -f html -o ${output.file_name} 
</command>
  <inputs>
      <param name="input" label="DESeq results" format="txt" type="data" />
      <param name="assoc" label="Association (GAF file)" format="gaf" type="data" />
      
      
      
      <param name="go_graph" label="GO annotation (OBO file)" format="obo" type="data" />
      <!-- <conditional name="go_graph">
        <param name="source" type="select" label="Gene Ontology Source">
             <option value="cached" selected="true">Locally Cached Alignments</option>
             <option value="user">Gene Ontology in Your History (in obo format)</option>
           </param>
          <when value="user">
              <param name="go_file" type="data" format="obo" label="GO annotation" />
          </when>
        <when value="cached">
            <param name="go_cashed" type="select" label="GO annotation" >
                <options from_file="go_index.loc">
                    <column name="name" index="0"/>
                    <column name="value" index="1"/>
                </options>
            </param>
        </when>
      </conditional>
      -->
      

      <conditional name="params">
	<param name="method" type="select" label="Enrichment analysis method">
          <option value="gsea">GSEA (uses ranking on log2FoldChange)</option>
          <option value="rpc">Ranked Parent-child (uses ranking on log2FoldChange)</option>
          <option value="pc">Parent-child</option>
	  <option value="tt">Term for term</option>
	</param>
	
	<when value="gsea">
	  <!-- <param name="perms" label="Number of permitations (for computing p-value)" type="integer" value="1000" min="10" max="10000" />-->
	  <param name="perms" label="Number of permitations (for computing p-value)" type="select" multiple="false" >
		<option value="10">10</option>
		<option value="100"  selected="True">100</option>
		<option value="1000">1000</option>
		<option value="10000">10000</option>
	  </param>
	  <param name="minset" label="Minimal intersection between set of genes in rank and in studied set" type="integer" value="1" min="1" max="100" />
	  <param name="corrpower" label="How strong correlation will affect enrichment" type="float" value="1" min="0" max="1" />
	</when>

	<when value="rpc">
	  <!-- <param name="perms" label="Number of permitations (for computing p-value)" type="integer" value="1000" min="10" max="10000" />-->
	  <param name="side" label="from which side (highest or lowest) to start computation" type="select" multiple="false" >
		<option value="+" selected="true" >highest (default)</option>
		<option value="-">lowest</option>
		<option value="+/-">both</option>
	  </param>
	  <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true"  display="checkboxes">
		<option value="bonferroni">Bonferroni</option>
		<option value="bh_fdr">Benjamini-Hochberg FDR</option>
	  </param>
	  <param name="rank" label="only the rank should be used as population" type="boolean" value="false" />
	  <param name="method" label="method used to compute probabilities" type="select" multiple="false" required="true" >
		<option value="union" selected="True">parent_child_union (default)</option>
		<option value="intersection">parent_child_intersection</option>
		<option value="term">Term for term</option>
	  </param>
	</when>

        <when value="pc">   
            <conditional name="cutoff">
                <param name="field" type="select" label="Which column to use">
                    <!--id      baseMean    baseMeanA       baseMeanB       foldChange      log2FoldChange  pval    padj-->
                    <option value="5">foldChange</option>
                    <option value="6">log2FoldChange</option>
                    <option value="7" selected="true">p-value</option>
                    <option value="8">p-value (adjusted)</option>
                </param>
                <when value="5">
                    <param name="level" label="Cut genes at this value in selected field (FoldChange >= value)" 
                    type="float" value="4"/>
                </when>
                <when value="6">
                    <param name="level" label="Cut genes at this value in selected field (log2FoldChange >= value)" 
                    type="float" value="2"/>
                </when>
                <when value="7">
                    <param name="level" label="Cut genes at this value in selected field (p-value &lt;= value)" 
                    type="float" value="0.05"/>
                </when>
                <when value="8">
                    <param name="level" label="Cut genes at this value in selected field (adjusted p-value &lt;= value)" 
                    type="float" value="0.05"/>
                </when>
          </conditional>
          <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true" display="checkboxes">
                <option value="bonferroni">Bonferroni</option>
                <option value="bh_fdr">Benjamini-Hochberg FDR</option>
          </param>
          <param name="method" label="method used to compute probabilities" type="select" multiple="false" required="true" >
                <option value="union" selected="True">parent_child_union (default)</option>
                <option value="intersection">parent_child_intersection</option>
          </param>
          
          
          
        </when>
        <when value="tt"> 
            <conditional name="cutoff">
                <param name="field" type="select" label="Which column to use">
                    <!--id      baseMean    baseMeanA       baseMeanB       foldChange      log2FoldChange  pval    padj-->
                    <option value="5">foldChange</option>
                    <option value="6">log2FoldChange</option>
                    <option value="7" selected="true">p-value</option>
                    <option value="8">p-value (adjusted)</option>
                </param>
                <when value="5">
                    <param name="level" label="Cut genes at this value in selected field (FoldChange >= value)" 
                    type="float" value="4"/>
                </when>
                <when value="6">
                    <param name="level" label="Cut genes at this value in selected field (log2FoldChange >= value)" 
                    type="float" value="2"/>
                </when>
                <when value="7">
                    <param name="level" label="Cut genes at this value in selected field (p-value &lt;= value)" 
                    type="float" value="0.05"/>
                </when>
                <when value="8">
                    <param name="level" label="Cut genes at this value in selected field (adjusted p-value &lt;= value)" 
                    type="float" value="0.05"/>
                </when>
          </conditional>
          <param name="corrections" label="multiple hypothesis testing corrections" type="select" multiple="true" >
                <option value="bonferroni">Bonferroni</option>
                <option value="bh_fdr">Benjamini-Hochberg FDR</option>
          </param>
          
        </when>

      </conditional>

  </inputs>
  <outputs>
        <data format="html" name="output" label="${tool.name} on ${on_string}"/>
  </outputs>

  <tests>
  </tests>

  <help>

Method and implementation: Kamil Koziara

Wrapper: Julia
  </help>

</tool>


